# ãƒ†ã‚¹ãƒˆç’°å¢ƒæ”¹å–„ææ¡ˆ

## æ¦‚è¦
VS Code Sidebar Terminalæ‹¡å¼µæ©Ÿèƒ½ã®ãƒ†ã‚¹ãƒˆç’°å¢ƒã‚’åŒ…æ‹¬çš„ã«æ”¹å–„ã—ã€é–‹ç™ºåŠ¹ç‡ã€å“è³ªä¿è¨¼ã€ä¿å®ˆæ€§ã‚’å‘ä¸Šã•ã›ã‚‹ææ¡ˆã§ã™ã€‚

## ç¾çŠ¶åˆ†æ

### ç¾åœ¨ã®ãƒ†ã‚¹ãƒˆç’°å¢ƒ
- **ãƒ†ã‚¹ãƒˆãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯**: Mocha + Chai + Sinon
- **ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ„ãƒ¼ãƒ«**: nyc (Istanbul)
- **ãƒ†ã‚¹ãƒˆç·æ•°**: 275+ tests
- **æˆåŠŸç‡**: 93% (ç›®æ¨™: 95%)
- **ã‚«ãƒãƒ¬ãƒƒã‚¸ç›®æ¨™**: Lines 70%, Functions 70%, Branches 60%
- **TDDå®Ÿè£…**: Red-Green-Refactor ã‚µã‚¤ã‚¯ãƒ«å®Ÿè£…æ¸ˆã¿

### ç‰¹å®šã•ã‚ŒãŸèª²é¡Œ

#### 1. ãƒ†ã‚¹ãƒˆå®Ÿè¡Œã®å®‰å®šæ€§
- **Mocha exit code 7 å•é¡Œ**: ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—å‡¦ç†ã§å®šæœŸçš„ã«exit code 7ãŒç™ºç”Ÿ
- **ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ä¾å­˜æ€§**: Windowsç’°å¢ƒã§node-ptyãƒ¢ãƒƒã‚¯ãŒå¿…è¦
- **è¡¨ç¤ºã‚µãƒ¼ãƒãƒ¼è¦ä»¶**: Linuxç’°å¢ƒã§xvfbå¿…é ˆ

#### 2. E2Eãƒ†ã‚¹ãƒˆåŸºç›¤
- **Playwrightæœªæ§‹æˆ**: è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ãŒå­˜åœ¨ã—ãªã„
- **ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«ãƒ†ã‚¹ãƒˆæœªå®Ÿè£…**: UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«ãƒªã‚°ãƒ¬ãƒƒã‚·ãƒ§ãƒ³ãƒ†ã‚¹ãƒˆãŒãªã„
- **E2Eã‚«ãƒãƒ¬ãƒƒã‚¸ä¸è¶³**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚·ãƒŠãƒªã‚ªãƒ™ãƒ¼ã‚¹ã®ãƒ†ã‚¹ãƒˆãŒé™å®šçš„

#### 3. ãƒ†ã‚¹ãƒˆãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹
- **ä¸¦åˆ—å®Ÿè¡Œæœªå¯¾å¿œ**: ãƒ†ã‚¹ãƒˆãŒé€æ¬¡å®Ÿè¡Œã•ã‚Œã¦ã„ã‚‹
- **é•·ã„ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ**: 30ç§’ã€œ120ç§’ã®è¨­å®šãŒå¤šã„
- **ãƒ†ã‚¹ãƒˆå®Ÿè¡Œæ™‚é–“**: CI/CDã§30åˆ†ã®ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆè¨­å®š

#### 4. ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸
- **ç›®æ¨™å€¤ãŒä½ã„**: æ¥­ç•Œæ¨™æº–ï¼ˆ80-90%ï¼‰ã«æ¯”ã¹ã¦ä½ã„è¨­å®š
- **æœªã‚«ãƒãƒ¼é ˜åŸŸ**: ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹ã‚„ä¾‹å¤–å‡¦ç†ã®ã‚«ãƒãƒ¬ãƒƒã‚¸ãŒä¸è¶³
- **ã‚«ãƒãƒ¬ãƒƒã‚¸å¯è¦–åŒ–**: ãƒ¬ãƒãƒ¼ãƒˆã®å¯è¦–åŒ–ãŒä¸ååˆ†

#### 5. ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
- **ã‚ªãƒ³ãƒœãƒ¼ãƒ‡ã‚£ãƒ³ã‚°**: æ–°è¦é–‹ç™ºè€…å‘ã‘ã‚¬ã‚¤ãƒ‰ãŒä¸è¶³
- **ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹**: æ–­ç‰‡çš„ãªãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
- **ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°**: æ—¢çŸ¥ã®å•é¡Œã®å¯¾å‡¦æ³•ãŒæ•£åœ¨

#### 6. ãƒ¢ãƒƒã‚¯ãƒ»ãƒ†ã‚¹ãƒˆãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
- **ãƒ¢ãƒƒã‚¯ç®¡ç†**: ä¸€å…ƒåŒ–ã•ã‚ŒãŸãƒ¢ãƒƒã‚¯ãƒ•ã‚¡ã‚¯ãƒˆãƒªãƒ¼ãŒä¸å®Œå…¨
- **å†åˆ©ç”¨æ€§**: ãƒ†ã‚¹ãƒˆãƒ˜ãƒ«ãƒ‘ãƒ¼ã®å†åˆ©ç”¨æ€§ãŒä½ã„
- **ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿**: ãƒ•ã‚£ã‚¯ã‚¹ãƒãƒ£ãƒ¼ç®¡ç†ãŒä¸æ˜ç¢º

## æ”¹å–„ææ¡ˆ

### å„ªå…ˆåº¦ 1: ç·Šæ€¥ãƒ»é‡è¦ï¼ˆ1-2é€±é–“ï¼‰

#### 1.1 ãƒ†ã‚¹ãƒˆå®Ÿè¡Œã®å®‰å®šåŒ–
**ç›®æ¨™**: Mocha exit code 7å•é¡Œã®æ ¹æœ¬è§£æ±º

**å®Ÿæ–½å†…å®¹**:
- ãƒ†ã‚¹ãƒˆã®ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—å‡¦ç†ã®è¦‹ç›´ã—
- ã‚°ãƒ­ãƒ¼ãƒãƒ«ãƒªã‚½ãƒ¼ã‚¹ã®é©åˆ‡ãªç ´æ£„å®Ÿè£…
- beforeEach/afterEachã®æœ€é©åŒ–
- ãƒ†ã‚¹ãƒˆéš”é›¢ã®å¼·åŒ–ï¼ˆãƒ†ã‚¹ãƒˆé–“ã®çŠ¶æ…‹å…±æœ‰æ’é™¤ï¼‰

**æœŸå¾…åŠ¹æœ**:
- ãƒ†ã‚¹ãƒˆæˆåŠŸç‡: 93% â†’ 98%
- CI/CDä¿¡é ¼æ€§ã®å‘ä¸Š
- ãƒ‡ãƒãƒƒã‚°æ™‚é–“ã®å‰Šæ¸›

**å®Ÿè£…ã‚¹ãƒ†ãƒƒãƒ—**:
```bash
# 1. ç¾åœ¨ã®ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—å‡¦ç†ã®ç›£æŸ»
npm run compile-tests
./node_modules/.bin/mocha --reporter tap 'out/test/**/*.test.js' > test-audit.log

# 2. ãƒªã‚½ãƒ¼ã‚¹ãƒªãƒ¼ã‚¯æ¤œå‡º
npm run test:unit -- --grep "cleanup|dispose|teardown"

# 3. ä¿®æ­£å®Ÿè£…
# - src/test/shared/TestSetup.ts ã®æ”¹å–„
# - å„ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã®afterEachè¦‹ç›´ã—
```

#### 1.2 ãƒ†ã‚¹ãƒˆä¸¦åˆ—å®Ÿè¡Œã®å°å…¥
**ç›®æ¨™**: ãƒ†ã‚¹ãƒˆå®Ÿè¡Œæ™‚é–“ã‚’50%å‰Šæ¸›

**å®Ÿæ–½å†…å®¹**:
- Mochaä¸¦åˆ—å®Ÿè¡Œã®æœ‰åŠ¹åŒ–
- ãƒ†ã‚¹ãƒˆã‚¹ã‚¤ãƒ¼ãƒˆã®åˆ†å‰²æœ€é©åŒ–
- ä¸¦åˆ—å®Ÿè¡Œå¯¾å¿œã®ãƒªã‚½ãƒ¼ã‚¹ç®¡ç†

**è¨­å®šä¾‹**:
```json
// .mocharc.json
{
  "parallel": true,
  "jobs": 4,
  "timeout": 5000,
  "retries": 1
}
```

**package.jsonæ›´æ–°**:
```json
{
  "scripts": {
    "test:unit:parallel": "mocha --parallel --jobs 4 'out/test/unit/**/*.test.js'",
    "test:integration:parallel": "mocha --parallel --jobs 2 'out/test/integration/**/*.test.js'"
  }
}
```

**æœŸå¾…åŠ¹æœ**:
- ãƒ†ã‚¹ãƒˆå®Ÿè¡Œæ™‚é–“: 10åˆ† â†’ 5åˆ†
- é–‹ç™ºè€…ã®å¾…ã¡æ™‚é–“å‰Šæ¸›
- CI/CDãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³é«˜é€ŸåŒ–

### å„ªå…ˆåº¦ 2: é‡è¦ï¼ˆ3-4é€±é–“ï¼‰

#### 2.1 Playwright E2Eãƒ†ã‚¹ãƒˆç’°å¢ƒæ§‹ç¯‰
**ç›®æ¨™**: å®Œå…¨ãªE2Eãƒ†ã‚¹ãƒˆåŸºç›¤ã®ç¢ºç«‹

**å®Ÿæ–½å†…å®¹**:
1. Playwrightè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆ
2. E2Eãƒ†ã‚¹ãƒˆã‚¹ã‚¤ãƒ¼ãƒˆã®å®Ÿè£…
3. ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«ãƒªã‚°ãƒ¬ãƒƒã‚·ãƒ§ãƒ³ãƒ†ã‚¹ãƒˆã®å°å…¥
4. CI/CDçµ±åˆ

**Playwrightè¨­å®š**:
```typescript
// playwright.config.ts
import { defineConfig } from '@playwright/test';

export default defineConfig({
  testDir: './e2e',
  timeout: 30000,
  fullyParallel: true,
  forbidOnly: !!process.env.CI,
  retries: process.env.CI ? 2 : 0,
  workers: process.env.CI ? 1 : undefined,
  reporter: [
    ['html'],
    ['junit', { outputFile: 'test-results/junit.xml' }]
  ],
  use: {
    trace: 'on-first-retry',
    screenshot: 'only-on-failure',
    video: 'retain-on-failure',
  },
  projects: [
    {
      name: 'chromium',
      use: { channel: 'chrome' },
    },
  ],
});
```

**E2Eãƒ†ã‚¹ãƒˆä¾‹**:
```typescript
// e2e/terminal-lifecycle.spec.ts
import { test, expect } from '@playwright/test';

test.describe('Terminal Lifecycle', () => {
  test('should create and manage multiple terminals', async ({ page }) => {
    // VS Codeæ‹¡å¼µæ©Ÿèƒ½ã®ãƒ†ã‚¹ãƒˆãƒšãƒ¼ã‚¸ã‚’é–‹ã
    await page.goto('vscode://extension/s-hiraoku.vscode-sidebar-terminal');

    // ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ä½œæˆ
    await page.click('[data-testid="create-terminal"]');
    await expect(page.locator('.terminal-instance')).toHaveCount(1);

    // ã‚¹ãƒ—ãƒªãƒƒãƒˆ
    await page.click('[data-testid="split-terminal"]');
    await expect(page.locator('.terminal-instance')).toHaveCount(2);

    // ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆæ¯”è¼ƒï¼ˆãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«ãƒªã‚°ãƒ¬ãƒƒã‚·ãƒ§ãƒ³ï¼‰
    await expect(page).toHaveScreenshot('terminal-split-view.png');
  });
});
```

**æœŸå¾…åŠ¹æœ**:
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚·ãƒŠãƒªã‚ªã®è‡ªå‹•æ¤œè¨¼
- UIãƒªã‚°ãƒ¬ãƒƒã‚·ãƒ§ãƒ³æ—©æœŸæ¤œå‡º
- E2Eã‚«ãƒãƒ¬ãƒƒã‚¸å‘ä¸Š

#### 2.2 ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸ç›®æ¨™ã®å¼•ãä¸Šã’
**ç›®æ¨™**: æ¥­ç•Œæ¨™æº–ãƒ¬ãƒ™ãƒ«ã®ã‚«ãƒãƒ¬ãƒƒã‚¸é”æˆ

**å®Ÿæ–½å†…å®¹**:
- ã‚«ãƒãƒ¬ãƒƒã‚¸ç›®æ¨™ã®æ®µéšçš„å¼•ãä¸Šã’
- æœªã‚«ãƒãƒ¼é ˜åŸŸã®ç‰¹å®šã¨æ”¹å–„
- ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ¬ãƒãƒ¼ãƒˆã®å¯è¦–åŒ–å¼·åŒ–

**æ®µéšçš„ç›®æ¨™**:
```json
// .nycrc.json - Phase 1 (ç¾åœ¨)
{
  "statements": 70,
  "lines": 70,
  "functions": 70,
  "branches": 60
}

// Phase 2 (1ãƒ¶æœˆå¾Œ)
{
  "statements": 80,
  "lines": 80,
  "functions": 75,
  "branches": 70
}

// Phase 3 (3ãƒ¶æœˆå¾Œ) - ç›®æ¨™
{
  "statements": 85,
  "lines": 85,
  "functions": 80,
  "branches": 75
}
```

**ã‚«ãƒãƒ¬ãƒƒã‚¸æ”¹å–„ã‚¹ã‚¯ãƒªãƒ—ãƒˆ**:
```bash
#!/bin/bash
# scripts/coverage-improvement.sh

echo "ğŸ“Š Generating coverage report..."
npm run test:coverage

echo "ğŸ” Identifying uncovered code..."
npx nyc report --reporter=text --reporter=html

echo "ğŸ“ˆ Coverage summary:"
npx nyc report --reporter=text-summary

# æœªã‚«ãƒãƒ¼é–¢æ•°ã®ãƒªã‚¹ãƒˆå‡ºåŠ›
echo "âŒ Uncovered functions:"
npx nyc report --reporter=json | jq '.[] | select(.functions.pct < 80) | .path'
```

**æœŸå¾…åŠ¹æœ**:
- ãƒã‚°æ¤œå‡ºç‡ã®å‘ä¸Š
- ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ã®å®‰å…¨æ€§å‘ä¸Š
- ã‚³ãƒ¼ãƒ‰å“è³ªã®å‘ä¸Š

#### 2.3 ãƒ†ã‚¹ãƒˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆä½“ç³»ã®æ•´å‚™
**ç›®æ¨™**: é–‹ç™ºè€…ãŒè¿·ã‚ãªã„ãƒ†ã‚¹ãƒˆç’°å¢ƒã®æä¾›

**å®Ÿæ–½å†…å®¹**:
1. **æ–°è¦é–‹ç™ºè€…å‘ã‘ã‚ªãƒ³ãƒœãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚¬ã‚¤ãƒ‰**
   - ãƒ†ã‚¹ãƒˆç’°å¢ƒã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—æ‰‹é †
   - æœ€åˆã®ãƒ†ã‚¹ãƒˆä½œæˆãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«
   - ã‚ˆãã‚ã‚‹è³ªå•ï¼ˆFAQï¼‰

2. **ãƒ†ã‚¹ãƒˆãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ã‚¬ã‚¤ãƒ‰**
   - ãƒ†ã‚¹ãƒˆãƒ‘ã‚¿ãƒ¼ãƒ³é›†
   - ãƒ¢ãƒƒã‚¯ä½œæˆã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³
   - éåŒæœŸãƒ†ã‚¹ãƒˆã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

3. **ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚¬ã‚¤ãƒ‰**
   - æ—¢çŸ¥ã®å•é¡Œã¨å›é¿ç­–
   - ãƒ‡ãƒãƒƒã‚°æ‰‹æ³•
   - ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è§£èª¬

**ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ§‹æˆ**:
```
docs/testing/
â”œâ”€â”€ README.md                          # ãƒ†ã‚¹ãƒˆæ¦‚è¦
â”œâ”€â”€ getting-started.md                 # åˆå¿ƒè€…ã‚¬ã‚¤ãƒ‰
â”œâ”€â”€ best-practices.md                  # ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹
â”œâ”€â”€ troubleshooting.md                 # ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°
â”œâ”€â”€ patterns/
â”‚   â”œâ”€â”€ unit-testing.md               # ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆãƒ‘ã‚¿ãƒ¼ãƒ³
â”‚   â”œâ”€â”€ integration-testing.md        # çµ±åˆãƒ†ã‚¹ãƒˆãƒ‘ã‚¿ãƒ¼ãƒ³
â”‚   â”œâ”€â”€ e2e-testing.md                # E2Eãƒ†ã‚¹ãƒˆãƒ‘ã‚¿ãƒ¼ãƒ³
â”‚   â””â”€â”€ performance-testing.md        # ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ†ã‚¹ãƒˆãƒ‘ã‚¿ãƒ¼ãƒ³
â””â”€â”€ tools/
    â”œâ”€â”€ mocha-guide.md                # Mochaä½¿ç”¨ã‚¬ã‚¤ãƒ‰
    â”œâ”€â”€ playwright-guide.md           # Playwrightä½¿ç”¨ã‚¬ã‚¤ãƒ‰
    â””â”€â”€ coverage-guide.md             # ã‚«ãƒãƒ¬ãƒƒã‚¸æ¸¬å®šã‚¬ã‚¤ãƒ‰
```

**æœŸå¾…åŠ¹æœ**:
- æ–°è¦é–‹ç™ºè€…ã®ã‚ªãƒ³ãƒœãƒ¼ãƒ‡ã‚£ãƒ³ã‚°æ™‚é–“: 2æ—¥ â†’ 0.5æ—¥
- ãƒ†ã‚¹ãƒˆä½œæˆæ™‚ã®è¿·ã„å‰Šæ¸›
- ãƒãƒ¼ãƒ å…¨ä½“ã®çŸ¥è­˜å…±æœ‰

### å„ªå…ˆåº¦ 3: ä¸­é•·æœŸï¼ˆ1-3ãƒ¶æœˆï¼‰

#### 3.1 ãƒ¢ãƒƒã‚¯ãƒ»ãƒ†ã‚¹ãƒˆãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ã®çµ±åˆ
**ç›®æ¨™**: ä¸€å…ƒåŒ–ã•ã‚ŒãŸå†åˆ©ç”¨å¯èƒ½ãªãƒ†ã‚¹ãƒˆã‚¤ãƒ³ãƒ•ãƒ©

**å®Ÿæ–½å†…å®¹**:
```typescript
// src/test/utils/MockFactory.ts
export class UnifiedMockFactory {
  static createVSCodeContext(): vscode.ExtensionContext {
    return {
      subscriptions: [],
      workspaceState: new MockMemento(),
      globalState: new MockMemento(),
      extensionPath: '/mock/path',
      storagePath: '/mock/storage',
      globalStoragePath: '/mock/global-storage',
      logPath: '/mock/log',
      extensionUri: vscode.Uri.file('/mock/path'),
      environmentVariableCollection: new MockEnvironmentVariableCollection(),
      extensionMode: vscode.ExtensionMode.Test,
      storageUri: vscode.Uri.file('/mock/storage'),
      globalStorageUri: vscode.Uri.file('/mock/global-storage'),
      logUri: vscode.Uri.file('/mock/log'),
      asAbsolutePath: (relativePath: string) => `/mock/path/${relativePath}`,
      secrets: new MockSecretStorage(),
    };
  }

  static createTerminalInstance(options?: Partial<TerminalOptions>): Terminal {
    // å†åˆ©ç”¨å¯èƒ½ãªã‚¿ãƒ¼ãƒŸãƒŠãƒ«ãƒ¢ãƒƒã‚¯
  }

  static createWebViewMock(options?: Partial<WebViewOptions>): WebView {
    // å†åˆ©ç”¨å¯èƒ½ãªWebViewãƒ¢ãƒƒã‚¯
  }
}

// src/test/utils/TestDataBuilder.ts
export class TestDataBuilder {
  private data: any = {};

  withTerminalCount(count: number): this {
    this.data.terminals = Array.from({ length: count }, (_, i) => ({
      id: i + 1,
      name: `Terminal ${i + 1}`,
    }));
    return this;
  }

  withScrollback(lines: string[]): this {
    this.data.scrollback = lines;
    return this;
  }

  build(): TestData {
    return this.data;
  }
}
```

**æœŸå¾…åŠ¹æœ**:
- ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ã®é‡è¤‡å‰Šæ¸›
- ãƒ†ã‚¹ãƒˆä½œæˆæ™‚é–“ã®çŸ­ç¸®
- ãƒ†ã‚¹ãƒˆãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹æ€§ã®å‘ä¸Š

#### 3.2 ãƒ†ã‚¹ãƒˆãƒ¡ãƒˆãƒªã‚¯ã‚¹ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰
**ç›®æ¨™**: ãƒ†ã‚¹ãƒˆå“è³ªã®å¯è¦–åŒ–ã¨ç¶™ç¶šçš„ç›£è¦–

**å®Ÿæ–½å†…å®¹**:
1. ãƒ†ã‚¹ãƒˆãƒ¡ãƒˆãƒªã‚¯ã‚¹åé›†è‡ªå‹•åŒ–
2. ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰æ§‹ç¯‰
3. ã‚¢ãƒ©ãƒ¼ãƒˆè¨­å®š

**ãƒ¡ãƒˆãƒªã‚¯ã‚¹é …ç›®**:
- ãƒ†ã‚¹ãƒˆæˆåŠŸç‡ï¼ˆæ™‚ç³»åˆ—ï¼‰
- ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒˆãƒ¬ãƒ³ãƒ‰
- ãƒ†ã‚¹ãƒˆå®Ÿè¡Œæ™‚é–“
- ãƒ•ãƒ¬ã‚¤ã‚¯ãƒ†ã‚¹ãƒˆæ¤œå‡º
- æ–°è¦ãƒ†ã‚¹ãƒˆè¿½åŠ ç‡

**å®Ÿè£…ä¾‹**:
```typescript
// scripts/collect-test-metrics.ts
interface TestMetrics {
  timestamp: string;
  totalTests: number;
  passedTests: number;
  failedTests: number;
  skippedTests: number;
  duration: number;
  coverage: {
    statements: number;
    branches: number;
    functions: number;
    lines: number;
  };
  flaky: string[];
}

async function collectMetrics(): Promise<TestMetrics> {
  // ãƒ†ã‚¹ãƒˆå®Ÿè¡Œã¨ãƒ¡ãƒˆãƒªã‚¯ã‚¹åé›†
}

async function publishMetrics(metrics: TestMetrics): Promise<void> {
  // GitHub Pagesã‚„ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã‚µãƒ¼ãƒ“ã‚¹ã«å…¬é–‹
}
```

**æœŸå¾…åŠ¹æœ**:
- ãƒ†ã‚¹ãƒˆå“è³ªã®å¯è¦–åŒ–
- å•é¡Œã®æ—©æœŸç™ºè¦‹
- ãƒ‡ãƒ¼ã‚¿ãƒ‰ãƒªãƒ–ãƒ³ãªæ”¹å–„

#### 3.3 CI/CDæœ€é©åŒ–
**ç›®æ¨™**: CI/CDãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³å®Ÿè¡Œæ™‚é–“ã®æœ€å°åŒ–

**å®Ÿæ–½å†…å®¹**:
1. ãƒ†ã‚¹ãƒˆã‚­ãƒ£ãƒƒã‚·ãƒ³ã‚°æˆ¦ç•¥ã®æ”¹å–„
2. ãƒãƒˆãƒªãƒƒã‚¯ã‚¹ãƒ“ãƒ«ãƒ‰ã®æœ€é©åŒ–
3. ãƒ†ã‚¹ãƒˆå¤±æ•—æ™‚ã®è¨ºæ–­æƒ…å ±å¼·åŒ–

**CI/CDæ”¹å–„ä¾‹**:
```yaml
# .github/workflows/ci-optimized.yml
name: CI Optimized

on: [push, pull_request]

jobs:
  test:
    strategy:
      fail-fast: false
      matrix:
        os: [ubuntu-latest, macos-latest, windows-latest]
        node: [18, 20, 22]
    runs-on: ${{ matrix.os }}

    steps:
      - uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: ${{ matrix.node }}
          cache: 'npm'

      - name: Cache test dependencies
        uses: actions/cache@v3
        with:
          path: |
            node_modules
            ~/.cache/ms-playwright
          key: ${{ runner.os }}-test-${{ hashFiles('**/package-lock.json') }}

      - name: Install dependencies
        run: npm ci --prefer-offline

      - name: Run tests (parallel)
        run: npm run test:parallel
        timeout-minutes: 10

      - name: Upload test results
        if: failure()
        uses: actions/upload-artifact@v3
        with:
          name: test-results-${{ matrix.os }}-node${{ matrix.node }}
          path: |
            coverage/
            test-results/
            screenshots/

      - name: Publish test report
        if: always()
        uses: mikepenz/action-junit-report@v4
        with:
          report_paths: 'test-results/junit.xml'
```

**æœŸå¾…åŠ¹æœ**:
- CI/CDå®Ÿè¡Œæ™‚é–“: 30åˆ† â†’ 10åˆ†
- ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ã‚µã‚¤ã‚¯ãƒ«ã®é«˜é€ŸåŒ–
- é–‹ç™ºè€…ä½“é¨“ã®å‘ä¸Š

## å®Ÿè£…ãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ—

### Phase 1: åŸºç›¤å®‰å®šåŒ– (Week 1-2)
- [ ] Mocha exit code 7å•é¡Œã®è§£æ±º
- [ ] ãƒ†ã‚¹ãƒˆä¸¦åˆ—å®Ÿè¡Œã®å°å…¥
- [ ] åŸºæœ¬çš„ãªãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ•´å‚™

**æˆæœç‰©**:
- å®‰å®šã—ãŸãƒ†ã‚¹ãƒˆå®Ÿè¡Œç’°å¢ƒ
- å®Ÿè¡Œæ™‚é–“50%å‰Šæ¸›
- ã‚ªãƒ³ãƒœãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚¬ã‚¤ãƒ‰

### Phase 2: E2Eå¼·åŒ– (Week 3-4)
- [ ] Playwrightç’°å¢ƒæ§‹ç¯‰
- [ ] E2Eãƒ†ã‚¹ãƒˆã‚¹ã‚¤ãƒ¼ãƒˆå®Ÿè£…
- [ ] ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«ãƒªã‚°ãƒ¬ãƒƒã‚·ãƒ§ãƒ³ãƒ†ã‚¹ãƒˆå°å…¥

**æˆæœç‰©**:
- å®Œå…¨ãªE2Eãƒ†ã‚¹ãƒˆç’°å¢ƒ
- ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«ãƒ†ã‚¹ãƒˆè‡ªå‹•åŒ–
- E2Eã‚«ãƒãƒ¬ãƒƒã‚¸40%ä»¥ä¸Š

### Phase 3: ã‚«ãƒãƒ¬ãƒƒã‚¸å‘ä¸Š (Week 5-8)
- [ ] ã‚«ãƒãƒ¬ãƒƒã‚¸ç›®æ¨™æ®µéšçš„å¼•ãä¸Šã’
- [ ] æœªã‚«ãƒãƒ¼é ˜åŸŸã®æ”¹å–„
- [ ] ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ¬ãƒãƒ¼ãƒˆå¼·åŒ–

**æˆæœç‰©**:
- ã‚«ãƒãƒ¬ãƒƒã‚¸85%é”æˆ
- ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹ãƒ†ã‚¹ãƒˆå……å®Ÿ
- ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰

### Phase 4: ç¶™ç¶šçš„æ”¹å–„ (Week 9-12)
- [ ] ãƒ¢ãƒƒã‚¯ãƒ»ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£çµ±åˆ
- [ ] ãƒ†ã‚¹ãƒˆãƒ¡ãƒˆãƒªã‚¯ã‚¹ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰
- [ ] CI/CDæœ€é©åŒ–

**æˆæœç‰©**:
- çµ±åˆãƒ†ã‚¹ãƒˆã‚¤ãƒ³ãƒ•ãƒ©
- ãƒ¡ãƒˆãƒªã‚¯ã‚¹ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰
- æœ€é©åŒ–ã•ã‚ŒãŸCI/CD

## æœŸå¾…ã•ã‚Œã‚‹åŠ¹æœ

### å®šé‡çš„åŠ¹æœ
- **ãƒ†ã‚¹ãƒˆæˆåŠŸç‡**: 93% â†’ 98%
- **ãƒ†ã‚¹ãƒˆå®Ÿè¡Œæ™‚é–“**: 10åˆ† â†’ 5åˆ†ï¼ˆä¸¦åˆ—å®Ÿè¡Œï¼‰
- **CI/CDæ™‚é–“**: 30åˆ† â†’ 10åˆ†
- **ã‚«ãƒãƒ¬ãƒƒã‚¸**: 70% â†’ 85%
- **ã‚ªãƒ³ãƒœãƒ¼ãƒ‡ã‚£ãƒ³ã‚°æ™‚é–“**: 2æ—¥ â†’ 0.5æ—¥

### å®šæ€§çš„åŠ¹æœ
- é–‹ç™ºè€…ã®ä¿¡é ¼æ€§å‘ä¸Š
- ãƒã‚°æ—©æœŸç™ºè¦‹ç‡ã®å‘ä¸Š
- ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ã®å®‰å…¨æ€§å‘ä¸Š
- ãƒãƒ¼ãƒ å…¨ä½“ã®çŸ¥è­˜å…±æœ‰ä¿ƒé€²
- æŠ€è¡“çš„è² å‚µã®å‰Šæ¸›

## å¿…è¦ãªãƒªã‚½ãƒ¼ã‚¹

### äººçš„ãƒªã‚½ãƒ¼ã‚¹
- **é–‹ç™ºãƒªãƒ¼ãƒ‰**: Phase 1-4 é€šã—ã¦é–¢ä¸ï¼ˆé€±10-15æ™‚é–“ï¼‰
- **é–‹ç™ºè€…**: Phaseåˆ¥ã«ã‚¢ã‚µã‚¤ãƒ³ï¼ˆé€±5-10æ™‚é–“ï¼‰
- **QAã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢**: E2Eãƒ†ã‚¹ãƒˆè¨­è¨ˆæ”¯æ´ï¼ˆé€±5æ™‚é–“ï¼‰

### æŠ€è¡“çš„ãƒªã‚½ãƒ¼ã‚¹
- è¿½åŠ npm packages:
  - `@playwright/test` (E2Eãƒ†ã‚¹ãƒˆ)
  - `mocha-parallel-tests` ã¾ãŸã¯ Mocha v8+ (ä¸¦åˆ—å®Ÿè¡Œ)
  - `nyc-config-custom` (ã‚«ãƒãƒ¬ãƒƒã‚¸è¨­å®šå¼·åŒ–)
  - ãƒ†ã‚¹ãƒˆãƒ¬ãƒãƒ¼ãƒˆãƒ„ãƒ¼ãƒ«å„ç¨®

### ã‚¤ãƒ³ãƒ•ãƒ©ã‚¹ãƒˆãƒ©ã‚¯ãƒãƒ£
- GitHub Actionså®Ÿè¡Œæ™‚é–“å¢—åŠ ï¼ˆç¾çŠ¶ç¶­æŒã§å¯èƒ½ï¼‰
- ãƒ†ã‚¹ãƒˆãƒ¬ãƒãƒ¼ãƒˆãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°ï¼ˆGitHub Pagesåˆ©ç”¨ï¼‰
- ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ï¼ˆGit LFS or å¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹ï¼‰

## ãƒªã‚¹ã‚¯ã¨è»½æ¸›ç­–

### ãƒªã‚¹ã‚¯1: ä¸¦åˆ—å®Ÿè¡Œã§ã®æ–°ã—ã„ä¸å…·åˆ
**å½±éŸ¿**: ãƒ†ã‚¹ãƒˆãŒä¸å®‰å®šã«ãªã‚‹å¯èƒ½æ€§
**è»½æ¸›ç­–**:
- æ®µéšçš„ãªå°å…¥ï¼ˆä¸€éƒ¨ãƒ†ã‚¹ãƒˆã‹ã‚‰é–‹å§‹ï¼‰
- ãƒ†ã‚¹ãƒˆéš”é›¢ã®å¾¹åº•
- ãƒ•ãƒ¬ã‚¤ã‚¯ãƒ†ã‚¹ãƒˆæ¤œå‡ºã¨ä¿®æ­£

### ãƒªã‚¹ã‚¯2: E2Eç’°å¢ƒæ§‹ç¯‰ã®è¤‡é›‘ã•
**å½±éŸ¿**: å®Ÿè£…æœŸé–“ãŒå»¶ã³ã‚‹å¯èƒ½æ€§
**è»½æ¸›ç­–**:
- Playwrightå…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«å¾“ã†
- VS Code Extension Test APIã‚’æ´»ç”¨
- æ®µéšçš„ãªæ©Ÿèƒ½è¿½åŠ 

### ãƒªã‚¹ã‚¯3: ã‚«ãƒãƒ¬ãƒƒã‚¸å‘ä¸Šã®ãŸã‚ã®å·¥æ•°å¢—
**å½±éŸ¿**: é–‹ç™ºé€Ÿåº¦ãŒä¸€æ™‚çš„ã«ä½ä¸‹
**è»½æ¸›ç­–**:
- æ®µéšçš„ãªç›®æ¨™è¨­å®š
- é‡è¦ãªé ˜åŸŸã‹ã‚‰å„ªå…ˆçš„ã«å¯¾å¿œ
- è‡ªå‹•åŒ–ã«ã‚ˆã‚‹åŠ¹ç‡åŒ–

## æˆåŠŸæŒ‡æ¨™ï¼ˆKPIï¼‰

### çŸ­æœŸï¼ˆ1-2ãƒ¶æœˆï¼‰
- [ ] ãƒ†ã‚¹ãƒˆæˆåŠŸç‡ 95%ä»¥ä¸Š
- [ ] ãƒ†ã‚¹ãƒˆå®Ÿè¡Œæ™‚é–“ 5åˆ†ä»¥å†…
- [ ] Mocha exit code 7å•é¡Œ 0ä»¶/é€±
- [ ] E2Eãƒ†ã‚¹ãƒˆã‚¹ã‚¤ãƒ¼ãƒˆæ§‹ç¯‰å®Œäº†

### ä¸­æœŸï¼ˆ3-6ãƒ¶æœˆï¼‰
- [ ] ã‚«ãƒãƒ¬ãƒƒã‚¸ 85%é”æˆ
- [ ] CI/CDå®Ÿè¡Œæ™‚é–“ 10åˆ†ä»¥å†…
- [ ] ãƒ†ã‚¹ãƒˆãƒ•ãƒ¬ã‚¤ã‚¯ç‡ 1%ä»¥ä¸‹
- [ ] ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå®Œæˆåº¦ 100%

### é•·æœŸï¼ˆ6-12ãƒ¶æœˆï¼‰
- [ ] ãƒ†ã‚¹ãƒˆæˆåŠŸç‡ 98%ç¶­æŒ
- [ ] æ–°è¦ãƒã‚°æ¤œå‡ºç‡ å‘ä¸Šï¼ˆãƒ†ã‚¹ãƒˆã§ã®æ¤œå‡ºç‡80%ä»¥ä¸Šï¼‰
- [ ] é–‹ç™ºè€…æº€è¶³åº¦ å‘ä¸Šï¼ˆã‚µãƒ¼ãƒ™ã‚¤å®Ÿæ–½ï¼‰
- [ ] ãƒ†ã‚¹ãƒˆè‡ªå‹•åŒ–ç‡ 95%ä»¥ä¸Š

## ã¾ã¨ã‚

ã“ã®ææ¡ˆã¯ã€VS Code Sidebar Terminalæ‹¡å¼µæ©Ÿèƒ½ã®ãƒ†ã‚¹ãƒˆç’°å¢ƒã‚’æ ¹æœ¬çš„ã«æ”¹å–„ã—ã€é–‹ç™ºåŠ¹ç‡ã€å“è³ªã€ä¿å®ˆæ€§ã‚’å¤§å¹…ã«å‘ä¸Šã•ã›ã‚‹ã‚‚ã®ã§ã™ã€‚æ®µéšçš„ãªã‚¢ãƒ—ãƒ­ãƒ¼ãƒã«ã‚ˆã‚Šã€ãƒªã‚¹ã‚¯ã‚’æœ€å°é™ã«æŠ‘ãˆãªãŒã‚‰ã€ç¢ºå®ŸãªåŠ¹æœã‚’å®Ÿç¾ã—ã¾ã™ã€‚

ãƒ†ã‚¹ãƒˆç’°å¢ƒã®æ”¹å–„ã¯ã€çŸ­æœŸçš„ãªæŠ•è³‡ã§é•·æœŸçš„ãªåˆ©ç›Šã‚’ã‚‚ãŸã‚‰ã™é‡è¦ãªå–ã‚Šçµ„ã¿ã§ã™ã€‚ã“ã®ææ¡ˆã®å®Ÿè£…ã«ã‚ˆã‚Šã€ãƒãƒ¼ãƒ å…¨ä½“ã®ç”Ÿç”£æ€§å‘ä¸Šã¨ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆå“è³ªã®å‘ä¸ŠãŒæœŸå¾…ã§ãã¾ã™ã€‚

---

**ææ¡ˆè€…**: Claude
**ææ¡ˆæ—¥**: 2025-11-08
**å¯¾è±¡ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: v0.1.94ä»¥é™
**å®Ÿè£…å„ªå…ˆåº¦**: High
