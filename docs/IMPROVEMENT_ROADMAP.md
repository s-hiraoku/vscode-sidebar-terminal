# Secondary Terminal 改善ロードマップ

最終更新: 2025-01-09

## 🎯 最も改善効果が高い領域

VS Code標準ターミナルとの比較分析に基づき、以下の改善項目を優先度順に提案します。

---

## 🔴 優先度1: セッション永続化の大幅強化

### 現状の課題
- **永続化保存行数**: わずか200行
- **VS Code再起動後**: 長いセッション履歴が失われる
- **AI Agent作業**: コンテキストの断絶

### 改善提案

#### Phase 1: 保存行数の拡大（即座に実装可能）
```typescript
// 現在
MAX_SCROLLBACK_FOR_PERSISTENCE: 200行

// 改善後
MAX_SCROLLBACK_FOR_PERSISTENCE: 1000行  // 5倍
```

**実装難易度**: ⭐ (低)
**影響度**: ⭐⭐⭐⭐⭐ (非常に高)
**ストレージ影響**: 約2-5MB増（gzip圧縮で緩和）

#### Phase 2: インテリジェント選択保存
```typescript
// 重要な内容を優先的に保存
interface SmartPersistence {
  // AI Agentの出力を優先
  cliAgentOutput: 500行

  // エラーメッセージを優先
  errorMessages: 200行

  // 通常出力
  standardOutput: 300行

  // 合計: 1000行
}
```

**実装難易度**: ⭐⭐ (中)
**影響度**: ⭐⭐⭐⭐⭐ (非常に高)

#### Phase 3: 段階的ロード機能
```typescript
// 大規模セッションの段階的復元
interface ProgressiveRestore {
  immediate: 200行,    // 即座に表示
  background: 800行,   // バックグラウンド読込
  onDemand: 無制限     // スクロール時に読込
}
```

**実装難易度**: ⭐⭐⭐ (中～高)
**影響度**: ⭐⭐⭐⭐ (高)

### 実装スケジュール
- **Week 1-2**: Phase 1実装（保存行数を1000行に）
- **Week 3-4**: Phase 2実装（インテリジェント選択）
- **Week 5-8**: Phase 3実装（段階的ロード）

### 期待される効果
- ✅ AI Agent作業の連続性向上
- ✅ デバッグ効率の大幅改善
- ✅ ユーザー満足度の向上
- ✅ VS Code標準との差別化強化

---

## 🟠 優先度2: 同時ターミナル数の拡張

### 現状の課題
- **現在の上限**: 5ターミナル
- **VS Code標準**: 無制限
- **ユーザー要望**: 最も多い改善要望

### 改善提案

#### Phase 1: 上限を10ターミナルに拡張
```typescript
// 現在
MAX_TERMINAL_COUNT: 5

// 改善後
MAX_TERMINAL_COUNT: 10
```

**必要な変更**:
1. ターミナルID管理の拡張（1-5 → 1-10）
2. UI/UXの最適化（タブ表示の改善）
3. パフォーマンステスト

**実装難易度**: ⭐⭐⭐ (中～高)
**影響度**: ⭐⭐⭐⭐⭐ (非常に高)

#### Phase 2: 動的上限設定
```typescript
interface DynamicTerminalLimit {
  default: 10,
  performance_mode: 5,    // 低スペックPC向け
  power_mode: 15,         // ハイスペックPC向け
  unlimited: 999          // 上級ユーザー向け
}
```

**実装難易度**: ⭐⭐⭐⭐ (高)
**影響度**: ⭐⭐⭐⭐ (高)

#### Phase 3: パフォーマンス最適化
- 非アクティブターミナルの出力停止
- メモリ使用量の動的調整
- バックグラウンドターミナルの軽量化

**実装難易度**: ⭐⭐⭐⭐⭐ (非常に高)
**影響度**: ⭐⭐⭐⭐ (高)

### 実装スケジュール
- **Week 1-4**: アーキテクチャ設計・検証
- **Week 5-8**: Phase 1実装（10ターミナル対応）
- **Week 9-12**: Phase 2実装（動的上限）
- **Week 13-16**: Phase 3実装（パフォーマンス最適化）

### リスク管理
- ⚠️ メモリ使用量の増加
- ⚠️ UI/UXの複雑化
- ⚠️ 既存機能への影響

### 期待される効果
- ✅ ユーザー満足度の大幅向上
- ✅ VS Code標準との競争力強化
- ✅ プロフェッショナルユーザーの獲得

---

## 🟡 優先度3: スクロールバック容量の無制限化

### 現状の課題
- **現在の上限**: 50,000行
- **VS Code標準**: 無制限
- **長時間実行**: ログが途切れる

### 改善提案

#### Phase 1: 上限を100,000行に拡張
```typescript
// 現在
MAX_SCROLLBACK_LINES: 50000

// 改善後
MAX_SCROLLBACK_LINES: 100000
```

**実装難易度**: ⭐ (低)
**影響度**: ⭐⭐⭐ (中)

#### Phase 2: 仮想スクロール実装
```typescript
// 大規模スクロールバックの効率的表示
interface VirtualScrolling {
  visible: 1000行,        // 表示中
  cached: 10000行,        // キャッシュ
  storage: 無制限          // ディスク保存
}
```

**実装難易度**: ⭐⭐⭐⭐ (高)
**影響度**: ⭐⭐⭐⭐ (高)

#### Phase 3: オンデマンドロード
- スクロール時に動的読込
- 古い履歴の自動アーカイブ
- 検索時の効率的スキャン

**実装難易度**: ⭐⭐⭐⭐⭐ (非常に高)
**影響度**: ⭐⭐⭐⭐ (高)

### 実装スケジュール
- **Week 1-2**: Phase 1実装（100,000行対応）
- **Week 3-8**: Phase 2実装（仮想スクロール）
- **Week 9-16**: Phase 3実装（オンデマンド）

---

## 🟢 優先度4: AI Agent機能の強化

### 改善提案

#### 1. より多様なCLI Agentへの対応
```typescript
// 現在
支援Agent: Claude Code, GitHub Copilot, Gemini CLI, CodeRabbit

// 追加対応
- Cursor AI
- Amazon CodeWhisperer
- Tabnine
- Codeium
- Sourcegraph Cody
```

#### 2. Agent間コンテキスト共有
```typescript
interface AgentContextSharing {
  // Agent間でファイル参照を共有
  sharedReferences: string[],

  // Agent間で会話履歴を共有
  conversationHistory: Message[],

  // Agent間でワークスペース状態を共有
  workspaceState: State
}
```

#### 3. マルチAgent並行作業の最適化
- Agent出力の視覚的分離
- Agent別のカラーコーディング
- Agent切り替えの高速化

**実装難易度**: ⭐⭐⭐ (中～高)
**影響度**: ⭐⭐⭐⭐ (高)

---

## 🔵 優先度5: UI/UX改善

### 改善提案

#### 1. タブUI の強化
- タブグループ機能
- タブの色分け
- タブのピン留め

#### 2. 分割表示の改善
- 3分割・4分割対応
- カスタムレイアウト保存
- ドラッグ&ドロップでの配置変更

#### 3. キーボードショートカットの拡充
- カスタマイズ可能なショートカット
- Agent別ショートカット
- クイックアクション機能

**実装難易度**: ⭐⭐ (中)
**影響度**: ⭐⭐⭐ (中)

---

## 📊 実装優先度マトリクス

```
影響度
  ↑
5 |  [優先度1]         [優先度2]
  |  セッション         同時ターミナル
4 |  永続化強化         数拡張
  |
3 |  [優先度4]         [優先度3]
  |  AI Agent強化      スクロールバック
2 |                    無制限化
  |
1 |  [優先度5]
  |  UI/UX改善
  |
  └────────────────────────────→
    1    2    3    4    5
            実装難易度
```

---

## 🎯 推奨実装順序

### フェーズ1: Quick Wins（1-2ヶ月）
1. ✅ セッション永続化を1000行に拡張
2. ✅ スクロールバック上限を100,000行に
3. ✅ 新しいCLI Agent 3-5種対応

**期待される効果**: ユーザー満足度の即座の向上

### フェーズ2: Major Features（3-6ヶ月）
1. ✅ 同時ターミナル数を10に拡張
2. ✅ インテリジェント選択保存実装
3. ✅ Agent間コンテキスト共有

**期待される効果**: VS Code標準との差別化強化

### フェーズ3: Advanced Features（6-12ヶ月）
1. ✅ 動的ターミナル数上限
2. ✅ 仮想スクロール実装
3. ✅ 段階的ロード機能

**期待される効果**: プロフェッショナルツールとしての地位確立

---

## 💡 最優先改善項目の詳細提案

### セッション永続化の1000行拡張（最優先）

#### 実装手順

**Step 1: 定数変更（5分）**
```typescript
// src/services/UnifiedTerminalPersistenceService.ts
- private static readonly MAX_SCROLLBACK_LINES = 200;
+ private static readonly MAX_SCROLLBACK_LINES = 1000;

// package.json
- "default": 200,
+ "default": 1000,
```

**Step 2: ストレージ設定調整（10分）**
```typescript
// package.json
"secondaryTerminal.scrollbackMaxStorageSize": {
  "default": 20971520,  // 20MB（2倍に増加）
  "maximum": 104857600  // 100MB（変更なし）
}
```

**Step 3: テスト実行（30分）**
- 大規模セッションの保存/復元テスト
- メモリ使用量の確認
- パフォーマンステスト

**Step 4: ドキュメント更新（15分）**
- README更新
- CHANGELOG追加
- 設定ガイド更新

**総所要時間**: 約1時間
**リスク**: 極めて低
**効果**: 即座に体感可能

#### 予想される改善効果

**ビフォー**:
- Claude Codeセッション: 最新200行のみ保存
- 長いデバッグセッション: コンテキスト失われる
- エラー調査: 古いログにアクセス不可

**アフター**:
- Claude Codeセッション: 最新1000行保存（**5倍**）
- 長いデバッグセッション: 十分なコンテキスト維持
- エラー調査: 詳細なログ履歴にアクセス可能

---

## 📈 成功指標（KPI）

### 実装後の測定指標

1. **ユーザー満足度**
   - GitHub Star数の増加率
   - VS Code Marketplace評価の向上
   - ユーザーフィードバックの改善

2. **機能使用率**
   - セッション復元の成功率
   - 平均保存行数
   - ユーザーあたりの平均ターミナル数

3. **パフォーマンス**
   - メモリ使用量（目標: 10%以内の増加）
   - 起動時間（目標: 20%以内の増加）
   - セッション復元時間（目標: 2秒以内）

4. **安定性**
   - クラッシュ率（目標: 0.1%以下）
   - エラー発生率（目標: 現状維持）
   - テストカバレッジ（目標: 90%以上）

---

## 結論

**最も改善効果が高い項目**:
🏆 **セッション永続化の1000行拡張**

**理由**:
- ✅ 実装難易度が極めて低い（1時間で完了）
- ✅ ユーザー影響度が非常に高い
- ✅ リスクが極めて低い
- ✅ 即座に体感できる改善
- ✅ AI Agent使用時の価値を大幅向上

**次のステップ**:
1. セッション永続化1000行拡張を即座に実装
2. ユーザーフィードバックを収集
3. 同時ターミナル数拡張の設計開始
