<!DOCTYPE html>
<html>
<head>
    <title>Terminal Resize Test</title>
    <style>
        body { margin: 0; padding: 20px; font-family: monospace; }
        .container { 
            border: 2px solid #333; 
            resize: both; 
            overflow: auto; 
            width: 600px; 
            height: 400px; 
            background: #000; 
            color: #fff;
            position: relative;
        }
        .terminal-screen { 
            width: 100%; 
            height: 100%; 
            background: #000;
        }
        .info {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(255,255,255,0.9);
            color: #000;
            padding: 5px;
            font-size: 12px;
            border-radius: 3px;
        }
    </style>
</head>
<body>
    <h2>Terminal Resize Test</h2>
    <p>Resize the container below and check the size limits:</p>
    <div class="container" id="container">
        <div class="terminal-screen" id="terminal"></div>
        <div class="info" id="info">Size: 600x400</div>
    </div>

    <script>
        // Test the resize calculation logic
        function calculateTerminalSize(containerWidth, containerHeight) {
            // Font metrics simulation (similar to xterm.js defaults)
            const charWidth = 9; // approximation
            const charHeight = 18; // approximation
            
            // Calculate raw dimensions
            const rawCols = Math.floor(containerWidth / charWidth);
            const rawRows = Math.floor(containerHeight / charHeight);
            
            // Apply xterm.js practical limits (same as our implementation)
            const cols = Math.max(Math.min(rawCols, 300), 1);
            const rows = Math.max(Math.min(rawRows, 200), 1);
            
            return { cols, rows, rawCols, rawRows };
        }

        // ResizeObserver to track container size changes
        const container = document.getElementById('container');
        const info = document.getElementById('info');
        
        const resizeObserver = new ResizeObserver(entries => {
            for (const entry of entries) {
                const { width, height } = entry.contentRect;
                const sizes = calculateTerminalSize(width, height);
                
                info.innerHTML = `
                    Container: ${Math.round(width)}x${Math.round(height)}<br>
                    Raw Terminal: ${sizes.rawCols}x${sizes.rawRows}<br>
                    Limited: ${sizes.cols}x${sizes.rows}
                    ${sizes.rawCols > 300 || sizes.rawRows > 200 ? '<br><span style="color:red">SIZE LIMITED!</span>' : ''}
                `;
                
                console.log('Resize:', {
                    container: `${width}x${height}`,
                    rawTerminal: `${sizes.rawCols}x${sizes.rawRows}`,
                    limitedTerminal: `${sizes.cols}x${sizes.rows}`,
                    limited: sizes.rawCols > 300 || sizes.rawRows > 200
                });
            }
        });
        
        resizeObserver.observe(container);
        
        // Initial calculation
        const rect = container.getBoundingClientRect();
        const sizes = calculateTerminalSize(rect.width, rect.height);
        info.innerHTML = `
            Container: ${Math.round(rect.width)}x${Math.round(rect.height)}<br>
            Raw Terminal: ${sizes.rawCols}x${sizes.rawRows}<br>
            Limited: ${sizes.cols}x${sizes.rows}
        `;
    </script>
</body>
</html>